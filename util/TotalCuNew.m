function k=TotalCuNew(u)

dist = zeros([size(u),8]);

u1 = u([end 1:end-1],:);
u2 = u([2:end 1],:);
u3 = u(:,[end 1:end-1]) ;
u4 = u(:,[2:end 1]);
u5 = u([end 1:end-1],[end 1:end-1]);
u6 = u([2:end 1],[2:end 1]);
u7 = u([end 1:end-1],[2:end 1]);
u8 = u([2:end 1],[end 1:end-1]);

u01 = (u([end 1:end-1],:) + u(:,:))/2;
u02 = (u([2:end 1],:) + u(:,:))/2;
u03 = (u(:,[end 1:end-1]) + u(:,:))/2;
u04 = (u(:,[2:end 1]) + u(:,:))/2;
u05 = (u([end 1:end-1],[end 1:end-1]) + u(:,[end 1:end-1]) + u([end 1:end-1],:) + u(:,:))/4;
u06 = (u([2:end 1],[2:end 1]) + u(:,[2:end 1]) + u([2:end 1],:) + u(:,:))/4;
u07 = (u([end 1:end-1],[2:end 1]) + u(:,[2:end 1]) + u([end 1:end-1],:) + u(:,:))/4;
u08 = (u([2:end 1],[end 1:end-1]) + u(:,[end 1:end-1]) + u([2:end 1],:) + u(:,:))/4;


dist(:,:,1) = ((2*u(:,:)-u3-u4)./sqrt((2*u1-u3-u4).^2 + (u3-u4).^2 + 4))./((u01 - u(:,:)).^2 +1);

dist(:,:,2) = ((u3+u4-2*u(:,:))./sqrt((2*u2-u3-u4).^2 + (u4-u3).^2 + 4))./((u02 - u(:,:)).^2 +1);

dist(:,:,3) = ((u1+u2-2*u(:,:))./sqrt((u1+u2-2*u3).^2 + (u2-u1).^2 + 4))./((u03 - u(:,:)).^2 +1);

dist(:,:,4) = ((2*u(:,:)-u1-u2)./sqrt((u1+u2-2*u4).^2 + (u1-u2).^2 + 4))./((u04 - u(:,:)).^2 +1);

dist(:,:,5) = ((u5+u7+u8-u1-u3-u(:,:))./sqrt((u8-u5).^2 + (u7-u5).^2 + 4))./((u05 - u(:,:)).^2 +2);

dist(:,:,6) = ((u(:,:)+u2+u4-u6-u7-u8)./sqrt((u7-u6).^2 + (u8-u6).^2 + 4))./((u06 - u(:,:)).^2 +2);

dist(:,:,7) = ((u(:,:)+u1+u4-u5-u6-u7)./sqrt((u7-u6).^2 + (u5-u7).^2 + 4))./((u07 - u(:,:)).^2 +2);

dist(:,:,8) = ((u5+u6+u8-u2-u3-u(:,:))./sqrt((u8-u5).^2 + (u6-u8).^2 + 4))./((u08 - u(:,:)).^2 +2);


k = abs(dist(:,:,1))+abs(dist(:,:,2))+abs(dist(:,:,3))+abs(dist(:,:,4))+abs(dist(:,:,5))+abs(dist(:,:,6))+abs(dist(:,:,7))+abs(dist(:,:,8));